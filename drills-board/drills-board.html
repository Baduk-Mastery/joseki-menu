<script>
(function restoreDrillsSelectionBridge(){
  // If the overlay is actually present on this page, do nothing.
  if (window.GoDrills && typeof window.GoDrills.getSelections === 'function') return;

  function readNextSelection(){
    try {
      const raw = sessionStorage.getItem('go:drills_next_selection');
      if (!raw) return null;
      const sel = JSON.parse(raw);

      if (!sel || typeof sel !== 'object') return null;

      sel.library   = Array.isArray(sel.library)   ? sel.library   : [];
      sel.favorites = Array.isArray(sel.favorites) ? sel.favorites : [];
      sel.own       = Array.isArray(sel.own)       ? sel.own       : [];
      sel.mode      = (sel.mode === 'blitz') ? 'blitz' : 'complete';

      return sel;
    } catch (e) {
      return null;
    }
  }

  const sel = readNextSelection();
  if (!sel) return;

  // Lightweight API expected by DrillBoard.load()
  window.GoDrills = {
    __ready: true,
    getSelections(){ return sel; },
    getLibrarySelection(){ return sel.library.slice(); },
    getFavoriteSelection(){ return sel.favorites.slice(); },
    getOwnSelection(){ return sel.own.slice(); },

    // Make "Back to selection" work on the board page
    open: function(){
      try { window.location.href = "../drills/drills.html"; } catch(_) {}
    },
    close: function(){}
  };

  // Optional: prevent stale reuse on refresh
  try { sessionStorage.removeItem('go:drills_next_selection'); } catch(_) {}
})();
</script>
