<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Plans</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <style>
    html, body{
      margin:0;
      padding:0;
      min-height:100%;
touch-action: none;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
/* Black reveal overlay (covers Plans on load, then fades away) */
#plans-fade{
  position: fixed;
  inset: 0;
  background: #000;
  z-index: 100001; /* above #plans-overlay (100000) */
  opacity: 1;
  transition: opacity .9s ease;
}

/* Triggered by JS */
#plans-fade.is-hidden{
  opacity: 0;
  pointer-events: none;
}

/* Accessibility */
@media (prefers-reduced-motion: reduce){
  #plans-fade{
    transition: none;
  }
}

#plans-overlay{
  position:fixed;
  inset:0;
  z-index:100000;
  display:none;                     /* JS will turn this to flex on load */
  justify-content:center;           /* center horizontally */
  align-items:flex-start;           /* pin to top so header is never cut */
  overflow:auto;                    /* overlay scrolls */
  -webkit-overflow-scrolling:touch; /* iOS smooth scroll */
  overscroll-behavior:contain;
  padding: calc(env(safe-area-inset-top, 0px) + 20px) 0
           calc(env(safe-area-inset-bottom, 0px) + 20px);
  color:#fff;
  -webkit-tap-highlight-color:transparent;
  isolation:isolate;
  box-sizing:border-box;

  --maxw:560px;
  --wood:url('https://3d85c7a311526e02aeeeb19e952d0c09.cdn.bubble.io/f1755870506985x437178801728222500/wood.jpg');

  background-image:
    linear-gradient(rgba(0,0,0,.35), rgba(0,0,0,.45)),
    var(--wood);
  background-size:cover;
  background-position:center;
}

#plans-overlay .s-inner{
  width:100%;
  max-width:var(--maxw);
  padding:12px 24px 22px;
  margin:0 auto;
  text-align:center;
  position:relative;
  box-sizing:border-box !important;
}

/* ===== Wood-style buttons (match Practice List + Settings) ===== */
#plans-overlay .s-back,
#plans-overlay .pl-btn{
  position:relative;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:6px;

  padding:8px 18px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.40);

  font-size:16px;
  font-weight:800;
  line-height:1.1;
  color:#fff3cf;
  text-shadow:0 1px 0 rgba(120,60,20,.7);
  cursor:pointer;

  user-select:none;
  -webkit-user-select:none;
  -moz-user-select:none;
  -ms-user-select:none;
  -webkit-tap-highlight-color:transparent;

  background-image:
    linear-gradient(
      to bottom,
      rgba(255,255,255,.12),
      rgba(255,255,255,.03) 38%,
      rgba(0,0,0,.14) 100%
    ),
    var(--wood);
  background-size:100% 100%, cover;
  background-position:center;
  background-repeat:no-repeat;

  filter:brightness(1.08) saturate(.96);

  box-shadow:
    0 3px 0 rgba(133,74,26,.85),
    0 8px 14px rgba(0,0,0,.45);

  transition:
    transform .08s ease-out,
    box-shadow .08s ease-out,
    filter .12s ease-out;

  white-space:nowrap;
}

/* Hover/active states */
#plans-overlay .s-back:hover,
#plans-overlay .pl-btn:hover{
  filter:brightness(1.12) saturate(.98);
  transform:translateY(-1px);
  box-shadow:
    0 4px 0 rgba(133,74,26,.9),
    0 10px 16px rgba(0,0,0,.48);
}

#plans-overlay .s-back:active,
#plans-overlay .pl-btn:active{
  filter:brightness(.97) saturate(.96);
  transform:translateY(2px);
  box-shadow:
    0 1px 0 rgba(120,60,20,.9),
    0 4px 8px rgba(0,0,0,.55);
}

/* Slim header back button (same compact feel as Practice header) */
#plans-overlay .pl-header .s-back{
  padding:6px 12px;
  font-size:14px;
  border-radius:8px;
}

/* Keep your CTA layout */
#plans-overlay .pl-cta{
  display:flex;
  gap:8px;
  padding:6px;
}
#plans-overlay .pl-btn{
  flex:1;
}

/* Selected/current plan emphasis (wood-style, not blue) */
#plans-overlay .pl-strong{
  filter:brightness(1.18) saturate(1.05);
  border-color:rgba(255,224,170,.85);
  box-shadow:
    0 4px 0 rgba(147,92,36,.96),
    0 12px 20px rgba(0,0,0,.58);
}

    /* ===== Header layout (row1: back + title; row2: status spans both) ===== */
    .pl-header{
      display:grid !important;
      grid-template-columns:auto 1fr;
      grid-template-rows:auto auto;
      align-items:center;
      column-gap:16px;
      row-gap:6px;
      margin-bottom:8px;
      text-align:left;
    }

    .pl-header .s-title{
      grid-column:2;
      grid-row:1;
      position:static !important;
      float:none !important;
      display:block !important;
      margin:0 !important;
      font-size:30px;
      line-height:1.12;
      font-weight:800;
      text-shadow:0 1px 2px rgba(0,0,0,.35);
      min-width:0;
    }
    .pl-header .pl-status{
      grid-column:1 / span 2;
      grid-row:2;
      margin:0;
      font-weight:700;
      color:#e6f3ff;
    }

    /* ===== Cards ===== */
    #plans-overlay .s-card{
      background: rgba(37,99,235,.22);
      border:2px solid rgba(37,99,235,.75);
      border-radius:12px;
      box-shadow:0 8px 20px rgba(2,6,23,.45), inset 0 0 0 1px rgba(255,255,255,.08);
      padding:12px;
      color:#e6f3ff;
    }
    .pl-grid{
      display:grid;
      gap:12px;
      margin-top:8px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 720px){
      .pl-grid{ grid-template-columns: 1fr 1fr; }
    }

    .pl-card{
      display:flex;
      flex-direction:column;
    }
    .pl-head{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      padding:6px 6px 0 6px;
      margin-bottom:4px;
    }
    .pl-name{
      font-size:20px;
      font-weight:800;
      letter-spacing:.2px;
      color:#e6f3ff;
    }
    .pl-price{
      font-size:22px;
      font-weight:900;
    }

    .pl-list{
      margin:6px 0 10px;
      padding:0 16px 0 24px;
    }
    .pl-list li{
      margin:6px 0;
    }
    .pl-list small{
      opacity:.85;
    }

    .pl-cta{
      display:flex;
      gap:8px;
      padding:6px;
    }
  
    .pl-note{
      opacity:.9;
      margin:12px 0 0;
      text-align:left;
    }

    /* Tiny screens */
    @media (max-width: 360px){
      .pl-header .s-title{
        font-size:26px;
      }
    }
  </style>
</head>
<body>
  <div id="plans-fade" aria-hidden="true"></div>
  <!-- ===== Plans Overlay (used here as full page) ===== -->
  <div id="plans-overlay" aria-modal="true" role="dialog" style="display:none">
    <div class="s-inner">
      <!-- Header: back + title; status -->
      <div class="pl-header">
        <button id="pl-back" class="s-back" type="button" aria-label="Back to menu">← Back</button>
        <h1 class="s-title">Choose Plan</h1>
        <div id="pl-status" class="pl-status" aria-live="polite">
          Your current plan: <strong id="pl-status-plan">Free</strong>
        </div>
      </div>

      <!-- Cards -->
      <div class="pl-grid">
        <!-- Free -->
        <section class="s-card pl-card" aria-label="Free plan">
          <header class="pl-head">
            <div class="pl-name">Free</div>
            <div class="pl-price">€0</div>
          </header>
          <ul class="pl-list">
            <li>Joseki board</li>
            <li>Practice Level 1–3</li>
            <li>3 Hints / day (Practice)</li>
            <li><strong>Drills:</strong> select up to <strong>2</strong> joseki variations; <strong>2</strong> runs/day</li>
          </ul>
          <div class="pl-cta">
            <button id="pl-free-keep" class="pl-btn" type="button">Keep Free</button>
          </div>
        </section>

        <!-- Pro -->
        <section class="s-card pl-card" aria-label="Pro plan">
          <header class="pl-head">
            <div class="pl-name">Pro</div>
            <div class="pl-price">—</div>
          </header>
          <ul class="pl-list">
            <li>Unlimited on Practice board</li>
            <li>Levels 4 &amp; 5 unlocked</li>
            <li>No daily limits</li>
            <li><strong>Drills:</strong> select up to <strong>10</strong> joseki variations; <strong>unlimited</strong> runs/day</li>
          </ul>
          <div class="pl-cta">
            <!-- pl-strong will be added/removed by JS depending on current plan -->
            <button id="pl-pro-activate" class="pl-btn" type="button">Go Pro</button>
          </div>
        </section>
      </div>
    </div>
  </div>

  <script>
  /* Plans overlay controller + current-plan status + limits for Drills */
  (function(){
    if (window.GoPlans && window.GoPlans.__ready) return;

    var panel    = document.getElementById('plans-overlay');
    if (!panel) return;

    var statusEl = document.getElementById('pl-status-plan');
    var freeBtn  = document.getElementById('pl-free-keep');
    var proBtn   = document.getElementById('pl-pro-activate');

    // Prevent double navigation when leaving to menu
    var leavingToMenu = false;


    // Fallback Tier store (until /shared/tier.js takes over)
    var Tier = window.Tier || {
      get: function(){
        try{
          return (localStorage.getItem('go_tier') || 'free').toLowerCase();
        }catch(e){
          return 'free';
        }
      },
      set: function(v){
        try{
          var t = (v || 'free').toLowerCase();
          localStorage.setItem('go_tier', t);
          window.dispatchEvent(new CustomEvent('tier:changed', { detail:{ tier:t } }));
        }catch(e){}
      }
    };

    // Limits for Drills (used by other pages via localStorage + optional events)
    var LIMITS_FREE = { drills: { maxSelections: 2,  triesPerDay: 2 } };
    var LIMITS_PRO  = { drills: { maxSelections: 10, triesPerDay: Number.POSITIVE_INFINITY } };

    function currentLimits(){
      return (Tier.get() === 'pro') ? LIMITS_PRO : LIMITS_FREE;
    }

    function emitLimitsChanged(){
      try{
        window.dispatchEvent(new CustomEvent('limits:changed', {
          detail: { tier: Tier.get(), limits: currentLimits() }
        }));
      }catch(e){}
    }

    // Global helper object (if any page wants it)
    window.GoLimits = {
      getTier: function(){ return Tier.get(); },
      get: function(){ return currentLimits(); },
      constants: { FREE: LIMITS_FREE, PRO: LIMITS_PRO }
    };

    function niceName(s){
      return (String(s || 'free').toLowerCase() === 'pro') ? 'Pro' : 'Free';
    }

function updateButtonStates(){
  if (!freeBtn || !proBtn) return;
  var tier = Tier.get();

  // Labels can still reflect the current plan
  if (tier === 'pro'){
    freeBtn.textContent = 'Go Free';
    proBtn.textContent  = 'Keep Pro';
  } else {
    freeBtn.textContent = 'Keep Free';
    proBtn.textContent  = 'Go Pro';
  }

  // Visual priority: always emphasize Pro
  freeBtn.classList.remove('pl-strong');
  proBtn.classList.add('pl-strong');
}


    function refreshStatus(){
      if (statusEl){
        statusEl.textContent = niceName(Tier.get());
      }
      updateButtonStates();
      emitLimitsChanged();
    }

    function open(){
      refreshStatus();
      panel.style.display = 'flex';
      panel.scrollTop = 0;
      // Lock background scroll on this page (harmless, but keeps behavior consistent)
      document.documentElement.style.overflow = 'hidden';
    }

    function close(){
      panel.style.display = 'none';
      document.documentElement.style.overflow = '';
    }

    function goBackToMenu(){
      if (leavingToMenu) return;
      leavingToMenu = true;

      // If used as overlay inside another page, fall back to GoMenu
      if (window.GoMenu && typeof window.GoMenu.open === 'function'){
        // In host-overlay mode we do want to close this panel and show the host page again
        close();
        window.GoMenu.open();
        return;
      }

      // Standalone Plans page:
      // Do NOT call close(); keep the wood overlay visible until navigation finishes.
      window.location.replace('../joseki-menu/index.html');
    }

    window.GoPlans = { open: open, close: close, __ready:true };

    // Back button
    var backBtn = document.getElementById('pl-back');
    if (backBtn){
      backBtn.addEventListener('click', function(){
        goBackToMenu();
      });
    }


    // ESC closes and goes back
    document.addEventListener('keydown', function(e){
      if (e.key === 'Escape' && panel.style.display !== 'none'){
        goBackToMenu();
      }
    });


    // Keep status in sync if someone else changes tier
    window.addEventListener('tier:changed', function(){
      refreshStatus();
    });

    // Free button behavior
    if (freeBtn){
      freeBtn.addEventListener('click', function(){
        var tier = Tier.get();

        if (tier === 'free'){
          // Keep Free: no change, just go back
          refreshStatus();
          goBackToMenu();
        } else {
          // Go Free: switch tier, update UI, go back
          Tier.set('free');
          refreshStatus();
          goBackToMenu();
        }
      });
    }


    // Pro button behavior
    if (proBtn){
      proBtn.addEventListener('click', function(){
        var tier = Tier.get();

        if (tier === 'pro'){
          // Keep Pro: no change, just go back
          refreshStatus();
          goBackToMenu();
        } else {
          // Go Pro: upgrade
          if (window.Paywall && typeof window.Paywall.open === 'function'){
            // In real app, Paywall would handle the upgrade process.
            window.Paywall.open();
            return;
          }
          Tier.set('pro');
          refreshStatus();
          goBackToMenu();
        }
      });
    }


    // Show the overlay immediately when this page loads
    open();
  })();
  </script>
<script>
  (function () {
    var fade = document.getElementById("plans-fade");
    if (!fade) return;

    var reduceMotion = window.matchMedia &&
      window.matchMedia("(prefers-reduced-motion: reduce)").matches;

    if (reduceMotion) {
      fade.remove();
      return;
    }

    function runReveal() {
      // snap to black without animating
      fade.style.transition = "none";
      fade.classList.remove("is-hidden");

      // force reflow so the browser applies opacity:1 immediately
      void fade.offsetHeight;

      // hand control back to CSS
      fade.style.transition = "";

      // fade out on next frame
      requestAnimationFrame(function () {
        fade.classList.add("is-hidden");
      });
    }

    // runs on first load AND when returning via back/forward cache
    window.addEventListener("pageshow", runReveal);
  })();
</script>

</body>
</html>
